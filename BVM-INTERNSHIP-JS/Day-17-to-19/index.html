<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  </head>

  <body>
    <style>
      h1 {
        font-size: 35px;
        text-align: center;
      }
      * {
        font-family: "Lucida Sans", "Lucida Sans Regular", "Lucida Grande",
          "Lucida Sans Unicode", Geneva, Verdana, sans-serif;
        font-size: large;
       
      }
      span {
        color: red;
      }
      /* table {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 10px;
      } */

      .minDiv {
        background-color: rgb(255, 255, 255);
        width: 600px;
        margin: 10px;
        padding: 20px;
        /* border: 2px solid rgb(255, 255, 255); */
        box-shadow: 7px 4px 10px 13px rgb(216, 216, 216);
        border-radius: 15px;
        /* background-image: url('https://usagif.com/wp-content/uploads/gifs/starfall-gif-46.gif'); */
         /* color: white; */
      }
      
      .input-style {
        background-color: rgb(255, 255, 255);
        color: rgb(0, 0, 0);
        font-family: "Franklin Gothic Medium", "Arial Narrow", Arial, sans-serif;
        height: 50px;
        width: 70%;
        border-radius: 5px;
        margin-left:80px ;
      }
      .input-style:hover{
        cursor:pointer;
        background-color: rgb(219, 219, 219);
        transform: scale(1.1);
        transition: 7ms;
      }
      .formStyle {
        text-align: left;
      }
      #form-Data {
        display: flex;
        justify-content: center;
        align-items: center;
        
      }
      .filter{
        text-align: center;
      }
      .input-length{
             width: 250px;
             height: 30px;
             border-radius: 6px;
      }
      #tablecss{
        display: flex;
        justify-content: center;
        align-items: center;

      }
      .delete{
        background-color: red; border-radius: 5px; border: none; color: white; padding: 7px; margin: 2px; cursor: pointer;
      }
      .edit{
        background-color: rgb(0, 89, 255); border-radius: 5px;border: none; color: white; padding: 7px; margin: 2px; cursor: pointer;
      }
      img{
        height: 50px;
        width: 50px;
      }
      tr{
        text-align: center;
      }
    </style>
    <!-- Form -->
    <div class="formStyle">
      <form id="form-Data">
        <div class="minDiv">
          <h1>STUDENT-FORM</h1>
          <label>First Name :</label>
          <input class="input-length" type="text" placeholder="Enter First Name" id="first-Name" />
          <span id="error_name"></span>
          <br /><br />
          <label>Last Name :</label>
          <input class="input-length" type="text" placeholder="Enter Last Name" id="last-Name" />
          <span id="error_last"></span>
          <br /><br />
          <label>Roll No :</label>
          <input class="input-length" type="number" placeholder="Enter Roll" id="rollNo" />
          <span id="error_roll"></span>
          <br /><br />
          <label>Date Of Birth :</label>
          <input class="input-length" type="date" id="DateOfBirth" />
          <span id="error_date"></span>
          <br /><br />
          <div>
            <label>Gender :</label>
            <input type="radio" name="gender" value="male" />
            <label>Male</label>
            <input type="radio" name="gender" value="female" />
            <label>Female</label>
            <input type="radio" name="gender" value="other" />
            <label>Other</label>
          </div>
          <span id="error_gender"></span>
          <br />
          <div>
            <label>Select Country :</label>
            <select id="select-country">
              <option value="" selected disabled hidden>Select Country</option>
              <option value="usa" value="">USA</option>
              <option value="india">India</option>
              <option value="canada">Canada</option>
            </select>
            <span id="error_country"></span>
          </div>
          <br />
          <div>
            <label>Select Language:</label>
            <input type="checkbox" name="language" value="english" />
            <label>English</label>
            <input type="checkbox" name="language" value="hindi" />
            <label>Hindi</label>
            <input type="checkbox" name="language" value="gujarati" />
            <label>Gujarati</label>
            <span id="error_language"></span>
          </div>

          <br />
          <div>
            <label>Profile Pic :</label>
            <input type="file" id="input-file"  multiple />
          </div>
          <br /><br>
          <input type="submit" class="input-style" />
          <br>
      </form>
      <br />
        </div>
        <br><br>
        <!-- Filter -->
          <div class="filter">
            <label>Select Option:</label>
            <select id="filter-gender">
              <option value="">All Gender</option>
              <option value="male">Male</option>
              <option value="female">female</option>
              <option value="other">Other</option>
            </select>
            <select id="filter-country">
              <option value="">All Country</option>
              <option value="usa">USA</option>
              <option value="india">India</option>
              <option value="canada">Canada</option>
            </select>
            <select id="filter-language">
              <option value="">All Language</option>
              <option value="english">English</option>
              <option value="hindi">Hindi</option>
              <option value="gujarati">Gujarati</option>
            </select>
          </div>
          <br><br>
      <!-- Table List -->
       <h1>TABLE-DATA</h1>
       <br><br>   
       <div class="table table-striped d-flex justify-content-center" id="tablecss" >
         
      <table border="3" class="tableStyle" >
       
        <thead>
          <tr>
            <th>Profile Pic</th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Roll No</th>
            <th>Date Of Birth</th>
            <th>Gender</th>
            <th>Country</th>
            <th>Language</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="student-data">
        </tbody>
      </table>
      </div>
    </div>
  </body>
  <!-- <script src="./script.js"></script> -->
   <script>
    document.addEventListener("DOMContentLoaded", function () {
  const form = document.getElementById("form-Data");
  const firstName = document.getElementById("first-Name");
  const lastName = document.getElementById("last-Name");
  const rollNo = document.getElementById("rollNo");
  const dateOfBirth = document.getElementById("DateOfBirth");
  const selectedCountry = document.getElementById("select-country");
  const imageFile = document.getElementById("input-file");
  const list = document.getElementById("student-data");

  const error_name = document.getElementById("error_name");
  const error_last = document.getElementById("error_last");
  const error_roll = document.getElementById("error_roll");
  const error_date = document.getElementById("error_date");
  const error_gender = document.getElementById("error_gender");
  const error_country = document.getElementById("error_country");
  const error_language = document.getElementById("error_language");

  let imageData = [];
  let selectedRow = null;
  let studentData = [];

  function loadLocalStorage() {
    const data = JSON.parse(localStorage.getItem("students")) || [];
    studentData = data;
    // store in localStorage but not show on Page
    renderTable();
  }
  function saveLocalStorage() {
    localStorage.setItem("students", JSON.stringify(studentData));
  }

 function renderTable() {
    list.innerHTML = "";

    studentData.forEach((student, index) => {
      const row = document.createElement("tr");

      const imageHTML = student.images.map(
        (src) => `<img src="${src}" height="50px" width="50px">`
      
      );
      row.innerHTML = `
        <td>${imageHTML}</td>
        <td>${student.fName}</td>
        <td>${student.lName}</td>
        <td>${student.roll}</td>
        <td>${student.dob}</td>
        <td>${student.gender}</td>
        <td>${student.country}</td>
        <td>${student.language}</td>
        <td>
          <button class="edit" data-index="${index}">Edit</button>
          <button class="delete" data-index="${index}">Delete</button>
        </td>
      `;
      list.appendChild(row);
    });
  }

  form.addEventListener("submit", function (e) {
    e.preventDefault();

    const fName = firstName.value;
    const lName = lastName.value;
    const roll = rollNo.value;
    const dob = dateOfBirth.value;
    const country = selectedCountry.value;
    const gender = form.querySelector('input[name="gender"]:checked')?.value;
    const language = Array.from(
      form.querySelectorAll('input[name="language"]:checked')
    ).map((input) => input.value);

    error_name.textContent = "";
    error_last.textContent = "";
    error_roll.textContent = "";
    error_date.textContent = "";
    error_gender.textContent = "";
    error_country.textContent = "";
    error_language.textContent = "";

    let isValid = true;

    if (!fName) {
      error_name.textContent = "First Name Required";
      isValid = false;
    }
    if (!lName) {
      error_last.textContent = "Last Name Required";
      isValid = false;
    }
    if (!roll) {
      error_roll.textContent = "Roll Number Required";
      isValid = false;
    }
    if (!dob) {
      error_date.textContent = "Date of Birth Required";
      isValid = false;
    }
    if (!gender) {
      error_gender.textContent = "Gender Required";
      isValid = false;
    }
    if (!country) {
      error_country.textContent = "Country Required";
      isValid = false;
    }
    if (language.length === 0) {
      error_language.textContent = "At least 1 Language Required";
      isValid = false;
    }

    if (!isValid) return;

    const student = {
      images: [...imageData],
      fName,
      lName,
      roll,
      dob,
      gender,
      country,
      language: language,
    };
    // console.log(student);

    if (selectedRow !== null) {
      const index = selectedRow.getAttribute("data-index");
      // console.log(selectedRow.getAttribute("data-index"));
      studentData[index] = student;
      // console.log(studentData[index]);
    } else {
      studentData.push(student);
      // console.log(studentData);
    }

    // to save in localStorage
    saveLocalStorage();
    // store in localStorage but not show in Page
    renderTable();
    // Form Reset
    form.reset();
  });

  imageFile.addEventListener("change", function () {
    imageData = [];
    const files = [...imageFile.files];

    files.forEach((file) => {
      const reader = new FileReader();
      reader.onload = function (e) {
        imageData.push(e.target.result);
      };
      reader.readAsDataURL(file);
    });
  });

  list.addEventListener("click", function (e) {
    const index = e.target.getAttribute("data-index");

    if (e.target.classList.contains("edit")) {
      selectedRow = e.target.closest("tr");

      selectedRow.setAttribute("data-index", index);

      const student = studentData[index];
      // console.log(studentData);

      firstName.value = student.fName;
      lastName.value = student.lName;
      rollNo.value = student.roll;
      dateOfBirth.value = student.dob;
      selectedCountry.value = student.country;

      imageData = [...student.images];
      // console.log(imageData);

      const genderInput = form.querySelector(
        `input[name="gender"][value="${student.gender}"]`
      );
      if (genderInput) genderInput.checked = true;

      form.querySelectorAll('input[name="language"]').forEach((input) => {
        input.checked = student.language.includes(input.value);
      });
    }

    if (e.target.classList.contains("delete")) {
      studentData.splice(index, 1);
      saveLocalStorage();
      renderTable();
    }
  });

  const Gender = document.getElementById("filter-gender");
  const Country = document.getElementById("filter-country");
  const Language = document.getElementById("filter-language");

  function Filter() {
    let genderValue = Gender.value;
    let countryValue = Country.value;
    let languageValue = Language.value;

    const rows = list.querySelectorAll("tr");

    rows.forEach((row) => {
      const gender = row.children[5].textContent;
      const country = row.children[6].textContent;
      const language = row.children[7].textContent;

      // console.log(gender);

      const genderMatch = genderValue === "" || gender === genderValue;
      // console.log(genderMatch);
      const countryMatch = countryValue === "" || country === countryValue;
      const languageMatch =
        languageValue === "" || language.includes(languageValue);

      if (genderMatch && countryMatch && languageMatch) {
        row.style.display = "";
      } else {
        row.style.display = "none";
      }
    });
  }
  Gender.addEventListener("change", Filter);
  Country.addEventListener("change", Filter);
  Language.addEventListener("change", Filter);

  loadLocalStorage();
});

   </script>
 </html>
